<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Dupe</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Dupe</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/lib/dupe/attribute_template_rb.html">
                lib/dupe/attribute_template.rb
                </a>
        <br />
                <a href="../files/lib/dupe/database_rb.html">
                lib/dupe/database.rb
                </a>
        <br />
                <a href="../files/lib/dupe/dupe_rb.html">
                lib/dupe/dupe.rb
                </a>
        <br />
                <a href="../files/lib/dupe/log_rb.html">
                lib/dupe/log.rb
                </a>
        <br />
                <a href="../files/lib/dupe/mock_rb.html">
                lib/dupe/mock.rb
                </a>
        <br />
                <a href="../files/lib/dupe/model_rb.html">
                lib/dupe/model.rb
                </a>
        <br />
                <a href="../files/lib/dupe/network_rb.html">
                lib/dupe/network.rb
                </a>
        <br />
                <a href="../files/lib/dupe/record_rb.html">
                lib/dupe/record.rb
                </a>
        <br />
                <a href="../files/lib/dupe/rest_validation_rb.html">
                lib/dupe/rest_validation.rb
                </a>
        <br />
                <a href="../files/lib/dupe/schema_rb.html">
                lib/dupe/schema.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <table>
<tr><td valign="top">Author:</td><td>Matt Parker (<a
href="mailto:moonmaster9000@gmail.com">moonmaster9000@gmail.com</a>)

</td></tr>
<tr><td valign="top">License:</td><td>Distributes under the same terms as Ruby

</td></tr>
</table>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000003">create</a>&nbsp;&nbsp;
      <a href="#M000011">debug</a>&nbsp;&nbsp;
      <a href="#M000002">define</a>&nbsp;&nbsp;
      <a href="#M000005">find</a>&nbsp;&nbsp;
      <a href="#M000006">find_or_create</a>&nbsp;&nbsp;
      <a href="#M000007">reset</a>&nbsp;&nbsp;
      <a href="#M000009">reset_database</a>&nbsp;&nbsp;
      <a href="#M000008">reset_models</a>&nbsp;&nbsp;
      <a href="#M000010">reset_network</a>&nbsp;&nbsp;
      <a href="#M000004">stub</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">debug</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
set this to &quot;true&quot; if you <a href="Dupe.html">Dupe</a> to spit
out mocked requests after each of your cucumber scenario&#8216;s run

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000003" class="method-detail">
        <a name="M000003"></a>

        <div class="method-heading">
          <a href="#M000003" class="method-signature">
          <span class="method-name">create</span><span class="method-args">(model_name, records={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method will cause <a href="Dupe.html">Dupe</a> to mock resources for
the record(s) provided. The &quot;records&quot; value may be either a hash
or an array of hashes. For example, suppose you&#8216;d like to mock a
single author:
</p>
<pre>
  author = Dupe.create :author, :name =&gt; 'Arthur C. Clarke'
    ==&gt; &lt;#Duped::Author name=&quot;Arthur C. Clarke&quot; id=1&gt;
</pre>
<p>
This will translate into the following two mocked resource calls:
</p>
<pre>
  # GET /authors.xml
  &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
  &lt;authors&gt;
    &lt;author&gt;
      &lt;id type=&quot;integer&quot;&gt;1&lt;/id&gt;
      &lt;name&gt;Arthur C. Clarke&lt;/name&gt;
    &lt;/author&gt;
  &lt;/authors&gt;

  # GET /authors/1.xml
  &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
  &lt;author&gt;
    &lt;id type=&quot;integer&quot;&gt;1&lt;/id&gt;
    &lt;name&gt;Arthur C. Clarke&lt;/name&gt;
  &lt;/author&gt;
</pre>
<p>
However, suppose you wanted to mock two or more authors.
</p>
<pre>
  authors = Dupe.create :author, [{:name =&gt; 'Arthur C. Clarke'}, {:name =&gt; 'Robert Heinlein'}]
    ==&gt; [&lt;#Duped::Author name=&quot;Arthur C. Clarke&quot; id=1&gt;, &lt;#Duped::Author name=&quot;Robert Heinlein&quot; id=2&gt;]
</pre>
<p>
This will translate into the following three mocked resource calls:
</p>
<pre>
  # GET /authors.xml
  &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
  &lt;authors&gt;
    &lt;author&gt;
      &lt;id type=&quot;integer&quot;&gt;1&lt;/id&gt;
      &lt;name&gt;Arthur C. Clarke&lt;/name&gt;
    &lt;/author&gt;
    &lt;author&gt;
      &lt;id type=&quot;integer&quot;&gt;2&lt;/id&gt;
      &lt;name&gt;Robert Heinlein&lt;/name&gt;
    &lt;/author&gt;
  &lt;/authors&gt;

  # GET /authors/1.xml
  &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
  &lt;author&gt;
    &lt;id type=&quot;integer&quot;&gt;1&lt;/id&gt;
    &lt;name&gt;Arthur C. Clarke&lt;/name&gt;
  &lt;/author&gt;

  # GET /authors/2.xml
  &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
  &lt;author&gt;
    &lt;id type=&quot;integer&quot;&gt;2&lt;/id&gt;
    &lt;name&gt;Robert Heinlein&lt;/name&gt;
  &lt;/author&gt;
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000003-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000003-source">
<pre>
<span class="ruby-comment cmt"># File lib/dupe/dupe.rb, line 222</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>(<span class="ruby-identifier">model_name</span>, <span class="ruby-identifier">records</span>={})
      <span class="ruby-identifier">model_name</span> = <span class="ruby-identifier">model_name</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">singularize</span>.<span class="ruby-identifier">to_sym</span>
      <span class="ruby-identifier">define</span> <span class="ruby-identifier">model_name</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">model_exists</span>(<span class="ruby-identifier">model_name</span>)
      <span class="ruby-identifier">create_and_insert</span> <span class="ruby-identifier">records</span>, <span class="ruby-identifier">:into</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">model_name</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="#M000011" class="method-signature">
          <span class="method-name">debug</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
set to true if you want to see mocked results spit out after each cucumber
scenario
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
<span class="ruby-comment cmt"># File lib/dupe/dupe.rb, line 398</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">debug</span>
      <span class="ruby-ivar">@debug</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">false</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000002" class="method-detail">
        <a name="M000002"></a>

        <div class="method-heading">
          <a href="#M000002" class="method-signature">
          <span class="method-name">define</span><span class="method-args">(*args) {|define| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Suppose we&#8216;re creating a &#8216;book&#8217; resource. Perhaps our app
assumes every book has a title, so let&#8216;s <a
href="Dupe.html#M000002">define</a> a book resource that specifies just
that:
</p>
<pre>
  irb# Dupe.define :book do |attrs|
   --#   attrs.title 'Untitled'
   --#   attrs.author
   --# end
    ==&gt; #&lt;Dupe::Model:0x17b2694 ...&gt;
</pre>
<p>
Basically, this reads like &quot;A book resource has a title attribute with
a default value of &#8216;Untitled&#8217;. It also has an author
attribute.&quot; Thus, if we <a href="Dupe.html#M000003">create</a> a book
and we don&#8216;t specify a &quot;title&quot; attribute, it should <a
href="Dupe.html#M000003">create</a> a &quot;title&quot; for us, as well as
provide a nil &quot;author&quot; attribute.
</p>
<pre>
  irb# b = Dupe.create :book
    ==&gt; &lt;#Duped::Book author=nil title=&quot;Untitled&quot; id=1&gt;
</pre>
<p>
If we provide our own title, it should allow us to override the default
value:
</p>
<pre>
  irb# b = Dupe.create :book, :title =&gt; 'Monkeys!'
    ==&gt; &lt;#Duped::Book author=nil title=&quot;Monkeys!&quot; id=2&gt;
</pre>
<h3>Attributes with procs as default values</h3>
<p>
Sometimes it might be convenient to procedurally <a
href="Dupe.html#M000002">define</a> the default value for an attribute:
</p>
<pre>
  irb# Dupe.define :book do |attrs|
   --#   attrs.title 'Untitled'
   --#   attrs.author
   --#   attrs.isbn do
   --#     rand(1000000)
   --#   end
   --# end
</pre>
<p>
Now, every time we <a href="Dupe.html#M000003">create</a> a book, it will
get assigned a random ISBN number:
</p>
<pre>
  irb# b = Dupe.create :book
    ==&gt; &lt;#Duped::Book author=nil title=&quot;Untitled&quot; id=1 isbn=895825&gt;

  irb# b = Dupe.create :book
    ==&gt; &lt;#Duped::Book author=nil title=&quot;Untitled&quot; id=2 isbn=606472&gt;
</pre>
<p>
Another common use of this feature is for associations. Lets suppose
we&#8216;d like to make sure that a book always has a genre, but a genre
should be it&#8216;s own resource. We can accomplish that by taking
advantage of <a href="Dupe.html">Dupe</a>&#8216;s &quot;<a
href="Dupe.html#M000006">find_or_create</a>&quot; method:
</p>
<pre>
  irb# Dupe.define :book do |attrs|
   --#   attrs.title 'Untitled'
   --#   attrs.author
   --#   attrs.isbn do
   --#     rand(1000000)
   --#   end
   --#   attrs.genre do
   --#     Dupe.find_or_create :genre
   --#   end
   --# end
</pre>
<p>
Now when we <a href="Dupe.html#M000003">create</a> books, <a
href="Dupe.html">Dupe</a> will associate them with an existing genre (the
first one it finds), or if none yet exist, it will <a
href="Dupe.html#M000003">create</a> one.
</p>
<p>
First, let&#8216;s confirm that no genres currently exist:
</p>
<pre>
  irb# Dupe.find :genre
  Dupe::Database::TableDoesNotExistError: The table ':genre' does not exist.
    from /Library/Ruby/Gems/1.8/gems/dupe-0.4.0/lib/dupe/database.rb:30:in `select'
    from /Library/Ruby/Gems/1.8/gems/dupe-0.4.0/lib/dupe/dupe.rb:295:in `find'
    from (irb):135
</pre>
<p>
Next, let&#8216;s <a href="Dupe.html#M000003">create</a> a book:
</p>
<pre>
  irb# b = Dupe.create :book
    ==&gt; &lt;#Duped::Book genre=&lt;#Duped::Genre id=1&gt; author=nil title=&quot;Untitled&quot; id=1 isbn=62572&gt;
</pre>
<p>
Notice that it <a href="Dupe.html#M000003">create</a> a genre. If we tried
to do another <a href="Dupe.html#M000005">Dupe.find</a> for the genre:
</p>
<pre>
  irb# Dupe.find :genre
    ==&gt; &lt;#Duped::Genre id=1&gt;
</pre>
<p>
Now, if <a href="Dupe.html#M000003">create</a> another book, it will
associate with the genre that was just created:
</p>
<pre>
  irb# b = Dupe.create :book
    ==&gt; &lt;#Duped::Book genre=&lt;#Duped::Genre id=1&gt; author=nil title=&quot;Untitled&quot; id=2 isbn=729317&gt;
</pre>
<h3>Attributes with transformers</h3>
<p>
Occasionally, you may <a href="Dupe.html#M000005">find</a> it useful to
have attribute values transformed upon creation.
</p>
<p>
For example, suppose we want to <a href="Dupe.html#M000003">create</a>
books with publish dates. In our cucumber scenario&#8216;s, we may prefer
to simply specify a date like &#8216;2009-12-29&#8217;, and have that
automatically transformed into an ruby Date object.
</p>
<pre>
  irb# Dupe.define :book do |attrs|
   --#   attrs.title 'Untitled'
   --#   attrs.author
   --#   attrs.isbn do
   --#     rand(1000000)
   --#   end
   --#   attrs.publish_date do |publish_date|
   --#     Date.parse(publish_date)
   --#   end
   --# end
</pre>
<p>
Now, let&#8216;s <a href="Dupe.html#M000003">create</a> a book:
</p>
<pre>
  irb# b = Dupe.create :book, :publish_date =&gt; '2009-12-29'
    ==&gt; &lt;#Duped::Book author=nil title=&quot;Untitled&quot; publish_date=Tue, 29 Dec 2009 id=1 isbn=826291&gt;

  irb# b.publish_date
    ==&gt; Tue, 29 Dec 2009

  irb# b.publish_date.class
    ==&gt; Date
</pre>
<h3>Callbacks</h3>
<p>
Suppose we&#8216;d like to make sure that our books get a unique label. We
can accomplish that with an after_create callback:
</p>
<pre>
  irb# Dupe.define :book do |attrs|
   --#   attrs.title 'Untitled'
   --#   attrs.author
   --#   attrs.isbn do
   --#     rand(1000000)
   --#   end
   --#   attrs.publish_date do |publish_date|
   --#     Date.parse(publish_date)
   --#   end
   --#   attrs.after_create do |book|
   --#     book.label = book.title.downcase.gsub(/\ +/, '-') + &quot;--#{book.id}&quot;
   --#   end
   --# end

  irb# b = Dupe.create :book, :title =&gt; 'Rooby on Rails'
    ==&gt; &lt;#Duped::Book author=nil label=&quot;rooby-on-rails--1&quot; title=&quot;Rooby on Rails&quot; publish_date=nil id=1 isbn=842518&gt;
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000002-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000002-source">
<pre>
<span class="ruby-comment cmt"># File lib/dupe/dupe.rb, line 143</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-comment cmt"># yield: define</span>
      <span class="ruby-identifier">model_name</span>, <span class="ruby-identifier">model_object</span> = <span class="ruby-identifier">create_model_if_definition_parameters_are_valid</span>(<span class="ruby-identifier">args</span>, <span class="ruby-identifier">block</span>)
      <span class="ruby-identifier">model_object</span>.<span class="ruby-identifier">tap</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">models</span>[<span class="ruby-identifier">model_name</span>] = <span class="ruby-identifier">m</span>
        <span class="ruby-identifier">database</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">model_name</span>
        <span class="ruby-identifier">mocks</span> = <span class="ruby-node">%{
          network.define_service_mock(
            :get, 
            %r{/#{model_name.to_s.pluralize}\\.xml$}, 
            proc { Dupe.find(:#{model_name.to_s.pluralize}) }
          )
          network.define_service_mock(
            :get, 
            %r{/#{model_name.to_s.pluralize}/(\\d+)\\.xml$}, 
            proc {|id| Dupe.find(:#{model_name}) {|resource| resource.id == id.to_i}}
          )  
        }</span>
        <span class="ruby-identifier">eval</span>(<span class="ruby-identifier">mocks</span>)
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000005" class="method-detail">
        <a name="M000005"></a>

        <div class="method-heading">
          <a href="#M000005" class="method-signature">
          <span class="method-name">find</span><span class="method-args">(model_name) {|record| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="Dupe.html">Dupe</a> has a built-in querying system for finding
resources you <a href="Dupe.html#M000003">create</a>.
</p>
<pre>
  irb# a = Dupe.create :author, :name =&gt; 'Monkey'
    ==&gt; &lt;#Duped::Author name=&quot;Monkey&quot; id=1&gt;

  irb# b = Dupe.create :book, :title =&gt; 'Bananas', :author =&gt; a
    ==&gt; &lt;#Duped::Book author=&lt;#Duped::Author name=&quot;Monkey&quot; id=1&gt; title=&quot;Bananas&quot; id=1&gt;

  irb# Dupe.find(:author) {|a| a.name == 'Monkey'}
    ==&gt; &lt;#Duped::Author name=&quot;Monkey&quot; id=1&gt;

  irb# Dupe.find(:book) {|b| b.author.name == 'Monkey'}
    ==&gt; &lt;#Duped::Book author=&lt;#Duped::Author name=&quot;Monkey&quot; id=1&gt; title=&quot;Bananas&quot; id=1&gt;

  irb# Dupe.find(:author) {|a| a.id == 1}
    ==&gt; &lt;#Duped::Author name=&quot;Monkey&quot; id=1&gt;

  irb# Dupe.find(:author) {|a| a.id == 2}
    ==&gt; nil
</pre>
<p>
In all cases, notice that we provided the singular form of a model name to
<a href="Dupe.html#M000005">Dupe.find</a>. This ensures that we either get
back either a single resource (if the query was successful), or
<em>nil</em>.
</p>
<p>
If we&#8216;d like to <a href="Dupe.html#M000005">find</a> several
resources, we can use the plural form of the model name. For example:
</p>
<pre>
  irb# a = Dupe.create :author, :name =&gt; 'Monkey', :published =&gt; true
    ==&gt; &lt;#Duped::Author published=true name=&quot;Monkey&quot; id=1&gt;

  irb# b = Dupe.create :book, :title =&gt; 'Bananas', :author =&gt; a
    ==&gt; &lt;#Duped::Book author=&lt;#Duped::Author published=true name=&quot;Monkey&quot; id=1&gt; title=&quot;Bananas&quot; id=1&gt;

  irb# Dupe.create :author, :name =&gt; 'Tiger', :published =&gt; false
    ==&gt; &lt;#Duped::Author published=false name=&quot;Tiger&quot; id=2&gt;

  irb# Dupe.find(:authors)
    ==&gt; [&lt;#Duped::Author published=true name=&quot;Monkey&quot; id=1&gt;, &lt;#Duped::Author published=false name=&quot;Tiger&quot; id=2&gt;]

  irb# Dupe.find(:authors) {|a| a.published == true}
    ==&gt; [&lt;#Duped::Author published=true name=&quot;Monkey&quot; id=1&gt;]

  irb# Dupe.find(:books)
    ==&gt; [&lt;#Duped::Book author=&lt;#Duped::Author published=true name=&quot;Monkey&quot; id=1&gt; title=&quot;Bananas&quot; id=1&gt;]

  irb# Dupe.find(:books) {|b| b.author.published == false}
    ==&gt; []
</pre>
<p>
Notice that by using the plural form of the model name, we ensure that we
receive back an array - even in the case that the query did not <a
href="Dupe.html#M000005">find</a> any results (it simply returns an empty
array).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000005-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000005-source">
<pre>
<span class="ruby-comment cmt"># File lib/dupe/dupe.rb, line 321</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find</span>(<span class="ruby-identifier">model_name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-comment cmt"># yield: record</span>
      <span class="ruby-identifier">results</span> = <span class="ruby-identifier">database</span>.<span class="ruby-identifier">select</span> <span class="ruby-identifier">model_name</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">singularize</span>.<span class="ruby-identifier">to_sym</span>, <span class="ruby-identifier">block</span>
      <span class="ruby-identifier">model_name</span>.<span class="ruby-identifier">plural?</span> <span class="ruby-value">? </span><span class="ruby-identifier">results</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">results</span>.<span class="ruby-identifier">first</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000006" class="method-detail">
        <a name="M000006"></a>

        <div class="method-heading">
          <a href="#M000006" class="method-signature">
          <span class="method-name">find_or_create</span><span class="method-args">(model_name, attributes={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method will <a href="Dupe.html#M000003">create</a> a resource with the
given specifications if one doesn&#8216;t already exist.
</p>
<pre>
  irb# Dupe.find :genre
  Dupe::Database::TableDoesNotExistError: The table ':genre' does not exist.
    from /Library/Ruby/Gems/1.8/gems/dupe-0.4.0/lib/dupe/database.rb:30:in `select'
    from /Library/Ruby/Gems/1.8/gems/dupe-0.4.0/lib/dupe/dupe.rb:295:in `find'
    from (irb):40

  irb# Dupe.find_or_create :genre
    ==&gt; &lt;#Duped::Genre id=1&gt;

  irb# Dupe.find_or_create :genre
    ==&gt; &lt;#Duped::Genre id=1&gt;
</pre>
<p>
You can also pass conditions to <a
href="Dupe.html#M000006">find_or_create</a> as a hash:
</p>
<pre>
  irb# Dupe.find_or_create :genre, :name =&gt; 'Science Fiction', :label =&gt; 'sci-fi'
    ==&gt; &lt;#Duped::Genre label=&quot;sci-fi&quot; name=&quot;Science Fiction&quot; id=2&gt;

  irb# Dupe.find_or_create :genre, :name =&gt; 'Science Fiction', :label =&gt; 'sci-fi'
    ==&gt; &lt;#Duped::Genre label=&quot;sci-fi&quot; name=&quot;Science Fiction&quot; id=2&gt;
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000006-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000006-source">
<pre>
<span class="ruby-comment cmt"># File lib/dupe/dupe.rb, line 347</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_or_create</span>(<span class="ruby-identifier">model_name</span>, <span class="ruby-identifier">attributes</span>={})
      <span class="ruby-identifier">results</span> = <span class="ruby-keyword kw">nil</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">model_exists</span>(<span class="ruby-identifier">model_name</span>)
        <span class="ruby-identifier">results</span> = <span class="ruby-identifier">eval</span>(<span class="ruby-node">&quot;find(:#{model_name}) #{build_conditions(attributes)}&quot;</span>)
      <span class="ruby-keyword kw">end</span>
      
      <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">results</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">model_name</span>.<span class="ruby-identifier">singular?</span>
          <span class="ruby-identifier">create</span> <span class="ruby-identifier">model_name</span>, <span class="ruby-identifier">attributes</span>
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-identifier">stub</span>((<span class="ruby-identifier">rand</span>(<span class="ruby-value">5</span>)<span class="ruby-operator">+</span><span class="ruby-value">1</span>), <span class="ruby-identifier">model_name</span>, <span class="ruby-identifier">:like</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">attributes</span>)
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">results</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">results</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-identifier">stub</span>((<span class="ruby-identifier">rand</span>(<span class="ruby-value">5</span>)<span class="ruby-operator">+</span><span class="ruby-value">1</span>), <span class="ruby-identifier">model_name</span>, <span class="ruby-identifier">:like</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">attributes</span>)
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-identifier">results</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">
          <a href="#M000007" class="method-signature">
          <span class="method-name">reset</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
clears out all model definitions and database records / tables.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000007-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000007-source">
<pre>
<span class="ruby-comment cmt"># File lib/dupe/dupe.rb, line 379</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset</span>
      <span class="ruby-identifier">reset_models</span>
      <span class="ruby-identifier">reset_database</span>
      <span class="ruby-identifier">reset_network</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">reset_database</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
<span class="ruby-comment cmt"># File lib/dupe/dupe.rb, line 389</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset_database</span>
      <span class="ruby-ivar">@database</span> = <span class="ruby-constant">Dupe</span><span class="ruby-operator">::</span><span class="ruby-constant">Database</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="#M000008" class="method-signature">
          <span class="method-name">reset_models</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
<span class="ruby-comment cmt"># File lib/dupe/dupe.rb, line 385</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset_models</span>
      <span class="ruby-ivar">@models</span> = {}
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="#M000010" class="method-signature">
          <span class="method-name">reset_network</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
<span class="ruby-comment cmt"># File lib/dupe/dupe.rb, line 393</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset_network</span>
      <span class="ruby-ivar">@network</span> = <span class="ruby-constant">Dupe</span><span class="ruby-operator">::</span><span class="ruby-constant">Network</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000004" class="method-detail">
        <a name="M000004"></a>

        <div class="method-heading">
          <a href="#M000004" class="method-signature">
          <span class="method-name">stub</span><span class="method-args">(count, model_name, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
You can use this method to quickly <a href="Dupe.html#M000004">stub</a> out
a large number of resources. For example:
</p>
<pre>
  Dupe.stub 20, :authors
</pre>
<p>
Assuming you had an :author resource definition like:
</p>
<pre>
  Dupe.define :author {|author| author.name('default')}
</pre>
<p>
then <a href="Dupe.html#M000004">stub</a> would have generated 20 author
records like:
</p>
<pre>
  &lt;#Duped::Author name=&quot;default&quot; id=1&gt;
  ....
  &lt;#Duped::Author name=&quot;default&quot; id=1&gt;
</pre>
<p>
and it would also have mocked <a href="Dupe.html#M000005">find</a>(id) and
<a href="Dupe.html#M000005">find</a>(:all) responses for these records
(along with any other custom mocks you&#8216;ve setup via
Dupe.define_mocks). (Had you not defined an author resource, then the <a
href="Dupe.html#M000004">stub</a> would have generated 20 author records
where the only attribute is the id).
</p>
<p>
Of course, it&#8216;s more likely that you wanted to dupe 20
<em>different</em> authors. You can accomplish this by simply doing:
</p>
<pre>
  Dupe.stub 20, :authors, :like =&gt; {:name =&gt; proc {|n| &quot;author #{n}&quot;}}
</pre>
<p>
which would generate 20 author records like:
</p>
<pre>
  &lt;#Duped::Author name=&quot;author 1&quot; id=1&gt;
  ....
  &lt;#Duped::Author name=&quot;author 20&quot; id=20&gt;
</pre>
<p>
Naturally, <a href="Dupe.html#M000004">stub</a> will consult the <a
href="Dupe.html#M000002">Dupe.define</a> definitions for anything
it&#8216;s attempting to <a href="Dupe.html#M000004">stub</a> and will
honor those definitions (default values, transformations, callbacks) as you
would expect.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000004-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000004-source">
<pre>
<span class="ruby-comment cmt"># File lib/dupe/dupe.rb, line 260</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stub</span>(<span class="ruby-identifier">count</span>, <span class="ruby-identifier">model_name</span>, <span class="ruby-identifier">options</span>={})
      <span class="ruby-identifier">start_at</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:starting_with</span>] <span class="ruby-operator">||</span> <span class="ruby-value">1</span>
      <span class="ruby-identifier">record_template</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:like</span>] <span class="ruby-operator">||</span> {}
      <span class="ruby-identifier">records</span> = []
      (<span class="ruby-identifier">start_at</span><span class="ruby-operator">..</span>(<span class="ruby-identifier">start_at</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">count</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>)).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">records</span> <span class="ruby-operator">&lt;&lt;</span> 
          <span class="ruby-identifier">record_template</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> 
            { <span class="ruby-identifier">k</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">v</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Proc</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">i</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">v</span>) }
          <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">inject</span>({}) {<span class="ruby-operator">|</span><span class="ruby-identifier">h</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">v</span>)}
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">create</span> <span class="ruby-identifier">model_name</span>, <span class="ruby-identifier">records</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>